<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>promise的基本使用理解 | 前端胖胖</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/verify_sheild.png">
    <meta name="description" content="孤独忧郁的前端胖胖">
    <link rel="preload" href="/assets/css/0.styles.9983b828.css" as="style"><link rel="preload" href="/assets/js/app.1a4d3165.js" as="script"><link rel="preload" href="/assets/js/2.93ef99a3.js" as="script"><link rel="preload" href="/assets/js/9.6a567b05.js" as="script"><link rel="preload" href="/assets/js/3.2659aaaf.js" as="script"><link rel="prefetch" href="/assets/js/10.fbea7bca.js"><link rel="prefetch" href="/assets/js/11.4bd8ab48.js"><link rel="prefetch" href="/assets/js/12.6579f1f7.js"><link rel="prefetch" href="/assets/js/13.cd2fa3a7.js"><link rel="prefetch" href="/assets/js/14.a4c8de90.js"><link rel="prefetch" href="/assets/js/15.f836e1f5.js"><link rel="prefetch" href="/assets/js/16.f4a3d43f.js"><link rel="prefetch" href="/assets/js/17.5d3578f0.js"><link rel="prefetch" href="/assets/js/4.d181edf8.js"><link rel="prefetch" href="/assets/js/5.691589d4.js"><link rel="prefetch" href="/assets/js/6.b33f8e23.js"><link rel="prefetch" href="/assets/js/7.0c1dd434.js"><link rel="prefetch" href="/assets/js/8.77f245d0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9983b828.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端胖胖</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  技术博客
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试总结
</a></div><div class="nav-item"><a href="/material/" class="nav-link">
  学习资料
</a></div> <a href="https://github.com/shelden-xie/shelden-xie.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  技术博客
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试总结
</a></div><div class="nav-item"><a href="/material/" class="nav-link">
  学习资料
</a></div> <a href="https://github.com/shelden-xie/shelden-xie.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>技术文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/notes-promise.html" aria-current="page" class="active sidebar-link">promise的基本使用理解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/notes-promise.html#一、为什么使用promise" class="sidebar-link">一、为什么使用Promise</a></li><li class="sidebar-sub-header"><a href="/blog/notes-promise.html#二、promise的基本介绍" class="sidebar-link">二、Promise的基本介绍</a></li><li class="sidebar-sub-header"><a href="/blog/notes-promise.html#三、promise的常用方法" class="sidebar-link">三、Promise的常用方法</a></li><li class="sidebar-sub-header"><a href="/blog/notes-promise.html#四、promise的缺点" class="sidebar-link">四、Promise的缺点</a></li><li class="sidebar-sub-header"><a href="/blog/notes-promise.html#五、个人总结" class="sidebar-link">五、个人总结</a></li></ul></li><li><a href="/blog/notes-es6.html" class="sidebar-link">ES6 总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>我的总结</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他模块</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promise的基本使用理解"><a href="#promise的基本使用理解" class="header-anchor">#</a> promise的基本使用理解</h1> <h2 id="一、为什么使用promise"><a href="#一、为什么使用promise" class="header-anchor">#</a> 一、为什么使用Promise</h2> <p>身为一个前端可能处理异步请求的时候会很苦恼，在第一个成功回调函数里面去写下一个回调函数，然后你就发现你就这样越写越长、越走越远，最后就会形成回调地狱。如果需要回调的函数少的话，还行。但是多的时候那是真的很恶心。下面的例子你想象一下很多的时候会写成什么样？（我去太可怕不能想）。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Ajax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">'XXX'</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'get'</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">first</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">second</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 一直走下去</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这个时候呢!，我们的主角就该登场了（撒花），<strong>Promise</strong>的出现很好地解决了这一问题。(ES6里面发布的promise，后面ES7出现 <strong>async/await</strong> 书写更加简便 )，本文就来简单介绍Promise</p> <h2 id="二、promise的基本介绍"><a href="#二、promise的基本介绍" class="header-anchor">#</a> 二、Promise的基本介绍</h2> <h3 id="创建promise"><a href="#创建promise" class="header-anchor">#</a> 创建Promise</h3> <p>Promise 是一个代理对象，它可以对你的异步操作进行一些处理，达到同步的返回，但是它的结果并不是一个值，而是一种代表结果的新的promise对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> FirstP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ?做一些异步操作，最终会调用下面两者之一:</span>
  <span class="token comment">//   resolve(success); // fulfilled</span>
  <span class="token comment">// ?或</span>
  <span class="token comment">//   reject(failure); // rejected</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 成功回调 获取resolve的输出值</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//错误回调 获取reject抛出的异常值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//错误回调</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>从上面可以看出Promise接受带有 resolve 和 reject 两个参数的函数 ，Promise一旦执行就会调用这个函数。</p> <p>一个 Promise有以下几种状态:</p> <ul><li>pending: 初始状态，既不是成功，也不是失败状态。</li> <li>fulfilled: 意味着操作成功完成。</li> <li>rejected: 意味着操作失败。</li></ul> <p>pending 状态的 Promise 对象可能会变为fulfilled 状态并传递一个值给相应的状态处理方法，也可能变为失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的 then 方法包含两个回调函数（handlers）:</p> <ul><li>onfulfilled，当promise状态为fulfilled时，调用这个函数；</li> <li>onrejected，当promise状态为rejected时，调用这个函数；</li></ul> <p><img src="https://user-gold-cdn.xitu.io/2020/4/30/171cbbc1f2a3a8e1?w=801&amp;h=297&amp;f=png&amp;s=21307" alt="引用自MDN"></p> <p>（当然，then里的参数是可选的，比如上面代码中catch(failureCallback) 是 then(null, failureCallback) 的缩略形式。）。注意几点：</p> <ol><li>reject后的东西，一定会进入then中的第二个回调，如果then中没有写第二个回调，则进入catch（但是then的第一个函数出错了，后面的catch可以捕获，写到then的第二个函数则捕获不到，并且catch可以捕获网络异常的错误，then的第二个回调处理不了），所以一般写的时候都选择链式调用catch方法来处理异常；</li> <li>resolve的东西，一定会进入then的第一个回调，肯定不会进入catch；</li> <li>throw new Error('错误') 和 rejected 两者一样，只会触发一个。;</li> <li>promise内部状态一旦发生改变，内部就会保护这个状态，不会改变。无论你在后面再添加多少会回调函数得到的都是这个状态的结果。</li> <li>如果在执行过程中并没有进行做一些reject错误处理的时候。全局就会触发&quot;unhandledrejection&quot;事件。我们可以利用此时间做一个兜底的错误处理。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unhandledrejection&quot;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">/* 你可以在这里添加一些代码，以便检查
         event.promise 中的 promise 和
         event.reason 中的 rejection 原因 */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>6.在进行promise.then链式调用时：</p> <p>第一、避免不必要的then的嵌套；<br>
第二、一定要接收到前一步返回的promise才可以继续进行链式调用，否则的话就会打破链条，或者更确切地说，我们有两个独立的链条竞争（同时在执行两个异步而非一个一个的执行），这意味着 doFourthThing() 不会等待 doSomethingElse() 或 doThirdThing() 完成，并且将与它们并行运行。</p> <p><em>错误</em>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>        <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doSomethingElse</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// 没有返回 Promise 以及没有必要的嵌套 Promise</span>
              <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">newResult</span> <span class="token operator">=&gt;</span> <span class="token function">doThirdThing</span><span class="token punctuation">(</span>newResult<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">doFourthThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><em>正确</em>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">newResult</span> <span class="token operator">=&gt;</span> <span class="token function">doThirdThing</span><span class="token punctuation">(</span>newResult<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">doFourthThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>相信你在了解到这的时候，应该就能明白promise在处理回调地狱的时候的过人之处了吧。</p> <h2 id="三、promise的常用方法"><a href="#三、promise的常用方法" class="header-anchor">#</a> 三、Promise的常用方法</h2> <p><strong>1. Promise.all(iterable)</strong>
方法返回一个 Promise 实例，iterable一般为一个数组对象，数组内所有的 promise 都“完成（resolved）”或参数中不包含 promise 时回调完成（resolve）；如果参数中  promise 有一个失败（rejected），此实例回调失败（reject），失败的原因是第一个失败 promise 的结果。(大家好才是真的好，一个不好都不好)</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// 如果传入进去的有一个不含有promise的值，这些值将被忽略，但仍然会被放在返回数组中。</span>
    <span class="token keyword">var</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果传入进去的有一个reject抛出的异常处理，这个Promise实例就会失败，并且返回出现错误的第一个错误信息</span>
    <span class="token keyword">var</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">555</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//加一个setTimeout保证主执行栈为空时再执行这段代码，否则的话输出的就是promise的pending的状态值。</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Promise { &lt;state&gt;: &quot;fulfilled&quot;, &lt;value&gt;: [1,2,3,4] }</span>
    <span class="token comment">// Promise { &lt;state&gt;: &quot;rejected&quot;, &lt;reason&gt;: 555 }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>2.Promise.race(iterable)</strong><br>
方法返回一个 promise，一旦迭代器中的某个promise解决或拒绝，返回的 promise就会解决或拒绝。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;two&quot;</span>
      <span class="token comment">// 两个都完成，但 p2 更快</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>以上这种情况基本用法，不管传进去的是resolve, 还是reject。谁先执行谁就先被返回。如果是resolve就直接被then捕获输出，如果是reject，则会被catch捕获。或者then的第二个onrejected()回调捕获。</p> <p><strong>3.Promise.any</strong>
接收一个Promise可迭代对象，只要其中的一个 promise 完成，就返回那个已经有完成值的 promise 。如果可迭代对象中没有一个 promise 完成（即所有的 promises 都失败/拒绝），就返回一个拒绝的 promise，返回值还有待商榷：无非是拒绝原因数组或AggregateError类型的实例，它是 Error 的一个子类，用于把单一的错误集合在一起。本质上，这个方法和Promise.all()是相反的。（处于试验（兼容）阶段，不推荐使用）。</p> <p><strong>4. Promise.allSettled</strong>
用法跟Promise.all一样，也是传入一个promise数组，但是 .then的回调函数的 参数不一样 promise.all返回的是一个数组，里面每个项都是按照你传入的promise的先后顺序执行的结果，Promise.allSettled返回的则是一个对象数组
这个对象数组每一个item，都有两个属性，一个status 值为 &quot;fulfilled&quot; 或者 &quot;rejected&quot; , 另一个value才是你要的执行结果，所以这里我们还得判断一下这个status是否为fulfilled, 再去改成我们想要的数据结构。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">;</span>

    Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// expected output:</span>
    <span class="token comment">// {status: &quot;fulfilled&quot;, value: 3}</span>
    <span class="token comment">//{status: &quot;rejected&quot;, reason: &quot;foo&quot;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个方法相比promise.all()的好处就是: 不管数组里面每一个promise或者非promise 已经完成，无论是成功的达成或通过被拒绝，它的状态都会被统一输入进一个对象数组里面。</p> <p><strong>适用场景：</strong> 比如在并发的处理多个请求时，不想因为某一个请求出现错误而导致其他请求无法返回时，从而导致其他请求全部挂掉。</p> <p><strong>4. Promise.prototype.finally()</strong>
此方法是原型链上定义的方法（当然还有then、catch这两种方法，就不做介绍了），次方法返回一个Promise。在promise结束时，无论结果是fulfilled或者是rejected，都会执行指定的回调函数。这为在Promise是否成功完成后都需要执行的代码提供了一种方式。这避免了同样的语句需要在then()和catch()中各写一次的情况。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> dialog <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">const</span> FirstP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dialog <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//dialog = false</span>
  <span class="token comment">// 成功回调 获取resolve的输出值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//dialog = false</span>
  <span class="token comment">//错误回调</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//此处无论promise成功失败都会执行，所以就不用在多个地方去设置dialog，只需在此处设置即可</span>
  dialog <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="四、promise的缺点"><a href="#四、promise的缺点" class="header-anchor">#</a> 四、Promise的缺点</h2> <p>1、promise一旦执行无法取消。<br>
2、如果不设置回调函数（catch或者then里面的onRejected函数）promise内部抛出的错误，不会反映到外部（粗心大意没写，但是可以通过hack处理）。<br>
3、当处于pending（进行中）的状态时，无法得知进行到那一阶段（刚开始或者即将完成）。比如你在请求某个接口超时时，你可能不知道接口是不是请求已经超时。<br>
4、then方法每一次调用的时候都会产生一个新的promise对象，容易造成内存浪费（不过一般相对来说不会考虑这一点）。</p> <h2 id="五、个人总结"><a href="#五、个人总结" class="header-anchor">#</a> 五、个人总结</h2> <p>本文promise的总结，都是平常的开发使用promise过程参考的一些资料，今天闲下来的时候，加上自己的理解给简单总结一下。其实promise还有很多的的东西。以后再学习的过程中，还会继续总结出来，后面我会把我上面的方法api都自己简单实现以下总结出来。有什么不好的地方希望老铁给指出来。谢谢！</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/3/2020, 7:13:33 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/notes-es6.html">
        ES6 总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1a4d3165.js" defer></script><script src="/assets/js/2.93ef99a3.js" defer></script><script src="/assets/js/9.6a567b05.js" defer></script><script src="/assets/js/3.2659aaaf.js" defer></script>
  </body>
</html>
