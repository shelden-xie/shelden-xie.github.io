# 函数式编程

## 一、什么是函数式编程

**定义：** 简单的来说，“函数式编程 （Functional Programming）” 其实是一种“编程范式”, 说白了就是如何编写程序的方法论。比如：

``` JS
// 你要实现（1+2）*3-4
// 传统的实现方式，你会写：
var a = 1 + 2;
var b = a * 3;
var c = b - 4;

// 函数式编程要求使⽤用函数，我们可以把运算过程定义为不不同的函数，然后写成下⾯面这样:：
var result = subtract(multiply(add(1, 2), 3), 4);

```  

从上面你就可以看出什么是函数式编程了。

## 二、函数式编程的特点

函数式编程具有五点显著的特点。

**1. 函数是"一等公民"**
所谓的 “一等公民”，其实就是说函数和其他数据类型的对象一样，处于平等的地位。可以对其赋值、可以当做参数传入另一个函数、也可以作为函数返回值。  

比如：

```JS
// 可以赋值
var test = function(i) {
  console.log(i)
}；
// 可以当做参数
[1, 2].map(test);

// 可以当做参数
function fn(i) {
  return test(i)
}
```

**2. 只用“表达式”，不用“语句”**  
"表达式"(expression)是⼀个单纯的运算过程，总是有返回值; "语句"(statement)是执行某种操作，没有返回值。函数式编程要求，只使⽤表达式，不使用语句。也就是说，每一步都是单纯的运算， ⽽且都有返回值。原因是函数式编程的开发动机，⼀开始就是为了处理运算(computation)，不考虑系统的读写 (I/O)。"语句"属于对系统的读写操作，所以就被排斥在外。当然，实际应用中，不做I/O是不可能的。因此，编程过程中，函数式编程只要求把I/O限制到最小，不要有不必要的读写行为，保持计算过程的单纯性。

**3. 没有“副作用”**  
所谓"副作用"(side effect)，指的是函数内部与外部互动(最典型的情况，就是修改全局变量的值)，产生运算以外的其他结果。函数式编程强调没有"副作用"，意味着函数要保持独⽴，所有功能就是返回一个新的值，没有其他行为，尤其是不得修改外部变量的值。

**4. 不修改状态**  
函数式编程是不修改系统变量的，只返回新的值，并不改变原始状态值。  
在其他类型的语言中，变量往往⽤来保存"状态"(state)。不修改变量，意味着状态不能保存在变量中。函数式编程使⽤参数保存状态，最好的例子就是递归。下⾯的代码是⼀个将字符串逆序排列的函数，它演示了不同的参数如何决定了运算所处的"状态"。

``` JS
function reverse(str) {
  if (str.length == 0) {
    return str;
  } else {
    return reverse(str.substring(1, str.length)) + str.substring(0, 1);
  }
}
```

由于使⽤了递归，函数式语⾔的运行速度⽐较慢，这是它⻓期不能在业界推广的主要原因。  

**5. 引用透明**  
引⽤透明(Referential transparency)，指的是函数的运行不依赖于外部变量或"状态"，只依赖于输入
的参数，任何时候只要参数相同，引⽤函数所得到的返回值总是相同的。  
有了前面的第三点和第四点，这点是很显然的。其他类型的语⾔，函数的返回值往往与系统状态有关，
不同的状态之下，返回值是不一样的。这就叫"引用不透明"，很不利于观察和理解程序的行为。  

## 三、函数式编程的意义  

**1. 代码简洁，开发快速**  
函数式编程大量使⽤函数，减少了代码的重复，因此程序⽐较短，开发速度较快。  

**2. 接近自然语言**  
易于理解 函数式编程的自由度很高，可以写出很接近自然语言的代码。

前⽂曾经将表达式(1 + 2) * 3 - 4，写成函数式语言:  

```JS
  subtract(multiply(add(1,2), 3), 4)  
```

对它进行变形，不难得到另一种写法:

```JS
add(1,2).multiply(3).subtract(4)  
```

这基本就是自然语言的表达了。再看下⾯的代码，⼤家应该一眼就能明白它的意思吧:

```JS
merge([1,2],[3,4]).sort().search("2")  
```

因此，函数式编程的代码更容易理解。  

**3. 更⽅便的代码管理**  
函数式编程不依赖、也不会改变外界的状态，只要给定输⼊参数，返回的结果必定相同。因此，每⼀个函数都可以被看做独⽴单元，很有利于进⾏单元测试(unit testing)和除错(debugging)，以及模块化组合。  

**4. 易于"并发编程"**  
函数式编程不需要考虑"死锁"(deadlock)，因为它不修改变量，所以根本不存在"锁"线程的问题。不必担心⼀个线程的数据，被另⼀个线程修改，所以可以很放⼼地把工作分摊到多个线程，部署"并发编程"(concurrency)。
请看下⾯的代码:

```JS
  var s1 = Op1();
  var s2 = Op2();
  var s3 = concat(s1, s2);
```

由于s1和s2互不干扰，不会修改变量，谁先执⾏是⽆所谓的，所以可以放⼼地增加线程，把它们分配在两个线程上完成。其他类型的语言就做不到这一点，因为s1可能会修改系统状态，⽽s2可能会⽤到这些状态，所以必须保证s2在s1之后运⾏，⾃然也就不能部署到其他线程上了。
多核CPU是将来的潮流，所以函数式编程的这个特性⾮常重要。  

**5. 代码的热升级**  
函数式编程没有副作⽤，只要保证接口不变，内部实现是外部无关的。所以，可以在运⾏状态下直接升级代码，不需要重启，也不需要停机。Erlang语⾔早就证明了这一点，它是瑞典爱立信公司为了管理电话系统⽽开发的，电话系统的升级当然是不能停机的。